name: RDP / Tailscale / RustDesk - PC A

on:
  workflow_dispatch:
    inputs:
      authkey:
        description: "Tailscale Auth Key"
        required: true
        type: string

jobs:
  connect-pc-a:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      # üîê Generate Username + Random Password

      - name: Generate Username & Password
        shell: pwsh
        run: |
          # Username Generator (8 characters: a-z0-9)
          $username = -join ((48..57) + (97..122) | Get-Random -Count 8 | ForEach-Object {[char]$_})

          # Password Generator (12 characters with special characters)
          Add-Type -AssemblyName System.Web
          $password = -join ((33..126) | Get-Random -Count 12 | ForEach-Object {[char]$_})

          # Show in logs
          echo "Username: $username"
          echo "Password: $password"

          # Export as environment variables (optional)
          echo "USERNAME=$username" | Out-File -FilePath $env:GITHUB_ENV -Append
          echo "PASSWORD=$password" | Out-File -FilePath $env:GITHUB_ENV -Append

      - name: Use Generated Credentials
        shell: pwsh
        run: |
          echo "Your generated Username is: $env:USERNAME"
          echo "Your generated Password is: $env:PASSWORD"
      
      # üü¢ Install RustDesk IF missing
      - name: Install RustDesk
        shell: powershell
        run: |
          $rd = "C:\Program Files\RustDesk\rustdesk.exe"
          if (-Not (Test-Path $rd)) {
              choco install rustdesk -y
              refreshenv
          }

      # üü¢ Launch RustDesk
      - name: Run RustDesk
        run: |
          Start-Process "C:\Program Files\RustDesk\rustdesk.exe"

      - name: Done
        run: echo "PC-A connected via Tailscale & RustDesk started."
