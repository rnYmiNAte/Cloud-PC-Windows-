name: RDP / Tailscale / RustDesk - PC A

on:
  workflow_dispatch:
    inputs:
      authkey:
        description: "Tailscale Auth Key"
        required: true
        type: string

jobs:
  connect-pc-a:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      # ðŸ” Generate PC Name + Random Password

      name: Generate-PC-Name-And-Password

on:
  workflow_dispatch:

jobs:
  generate:
    runs-on: windows-latest

    steps:
      - name: Generate PC name and password
        shell: pwsh
        run: |
          # Generate PC name (Date + Random number)
          $pcName = "PC-" + (Get-Date -Format "yyyyMMdd-HHmmss") + "-" + (Get-Random -Maximum 9999)

          # Manual password generator (12 chars, includes symbols)
          $chars = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*"
          $password = -join ((1..12) | ForEach-Object { $chars[(Get-Random -Maximum $chars.Length)] })

          # Output results
          Write-Output "PC Name: $pcName"
          Write-Output "Password: $password"

          # Save as environment variables
          echo "PC_NAME=$pcName" >> $env:GITHUB_ENV
          echo "PASSWORD=$password" >> $env:GITHUB_ENV

      - name: Show Generated Values
        run: |
          echo "Generated PC Name: $env:PC_NAME"
          echo "Generated Password: $env:PASSWORD"

      # ðŸŸ¢ Install RustDesk IF missing
      - name: Install RustDesk
        shell: powershell
        run: |
          $rd = "C:\Program Files\RustDesk\rustdesk.exe"
          if (-Not (Test-Path $rd)) {
              choco install rustdesk -y
              refreshenv
          }

      # ðŸŸ¢ Launch RustDesk
      - name: Run RustDesk
        run: |
          Start-Process "C:\Program Files\RustDesk\rustdesk.exe"

      - name: Done
        run: echo "PC-A connected via Tailscale & RustDesk started."
