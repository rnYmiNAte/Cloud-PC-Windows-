name: RDP / Tailscale / RustDesk - PC A

on:
  workflow_dispatch:
    inputs:
      authkey:
        description: "Tailscale Auth Key"
        required: true
        type: string

jobs:
  connect-pc-a:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      # ðŸ” Generate PC Name + Random Password

      - name: Generate PC name and password
      shell: powershell
      run: |
        # Generate PC Name
        $pcname = "PC-" + -join ((65..90) + (97..122) | Get-Random -Count 6 | % {[char]$_})

        # Generate Secure Password (12 bytes â†’ Base64)
        Add-Type -AssemblyName System.Security
        $bytes = New-Object 'System.Byte[]' 12
        [System.Security.Cryptography.RandomNumberGenerator]::Create().GetBytes($bytes)
        $password = [Convert]::ToBase64String($bytes)

        Write-Host "PC Name: $pcname"
        Write-Host "Password: $password"

        # Save to ENV for next steps
        echo "PC_NAME=$pcname" >> $env:GITHUB_ENV
        echo "USER_PASS=$password" >> $env:GITHUB_ENV

      # ðŸŸ¢ Install RustDesk IF missing
      - name: Install RustDesk
        shell: powershell
        run: |
          $rd = "C:\Program Files\RustDesk\rustdesk.exe"
          if (-Not (Test-Path $rd)) {
              choco install rustdesk -y
              refreshenv
          }

      # ðŸŸ¢ Launch RustDesk
      - name: Run RustDesk
        run: |
          Start-Process "C:\Program Files\RustDesk\rustdesk.exe"

      - name: Done
        run: echo "PC-A connected via Tailscale & RustDesk started."
